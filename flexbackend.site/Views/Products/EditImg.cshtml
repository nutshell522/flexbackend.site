@model Flex.Products.dll.Models.ViewModel.ProductEditImgVM

@{
    ViewBag.Title = "編輯商品圖片";
}

<h2>編輯商品圖片</h2>


@using (Html.BeginForm("EditImg", "Products",FormMethod.Post,new { enctype ="multipart/form-data"}))
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model=>model.ProductId)

    <div id="editImg" class="border border-3 rounded-2 mb-3">
        <div id="previewImages">
            @for (var i = 0; i < Model.ProductImgs.Count; i++)
            {
                <div class="img-group m-2">
                    <img src="~/Public/Img/@Model.ProductImgs[i].ImgPath" style="width:150px;height:150px" />
                    <input type="hidden" name="ProductImgs[@i].ProductImgId" value="@Model.ProductImgs[i].ProductImgId" />
                    <input type="hidden" name="ProductImgs[@i].ImgPath" value="@Model.ProductImgs[i].ImgPath" />
                    <input type="hidden" name="ProductImgs[@i].fk_ProductId" value="@Model.ProductId" />
                    <input type="button" value="刪除" class="btn btn-danger ms-3 deleteImgBtn" />
                </div>
            }
        </div>
    </div>

        <div class="mb-3">
            @Html.LabelFor(model=>model.ProductImgs, htmlAttributes:new {@class="form-label"})
            <input type="file" name="createfile" id="createfile" class="form-control" multiple/>
            @Html.ValidationMessageFor(model => model.ProductImgs, "", new {@class="text-danger"})
        </div>
        <div class="mb-3">
            <input type="submit" value="確認" class="btn btn-primary" />
            <input type="button" value="取消" class="btn btn-primary" onclick='location.href="@Url.Action("Index")"' />
        </div>
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            var delBtn = $(".deleteImgBtn");
            var previewImages = $("#previewImages");

            delBtn.click(function () {
                $(this).parent(".img-group").remove();

                $(".img-group").each(function (index) {
                    $(this).find("input[name^='ProductImgs']").eq(0).attr("name", "ProductImgs[" + index + "].ProductImgId");
                    $(this).find("input[name^='ProductImgs']").eq(1).attr("name", "ProductImgs[" + index + "].ImgPath");
                    $(this).find("input[name^='ProductImgs']").eq(2).attr("name", "ProductImgs[" + index + "].fk_ProductId");
                })
            })
        })
    </script>
    @Scripts.Render("~/bundles/jqueryval")
}
